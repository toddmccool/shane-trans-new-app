<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shane's Chord Chart Transposer</title>
    <style>
      body {
        color: white;
        background-image: url("shaneSitting.jpg");
        background-repeat: no-repeat;
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
      }
    </style>
  </head>

  <body>
    <h1>Shane's Jesus Christ <i>(trans) </i>Pose App</h1>
    <div>
      <label for="songChart">enter your Song Chart here â†“</label><br />
      <textarea id="songChart" rows="10" cols="50"></textarea>
    </div>
    <br />
    <br />

    <button onclick="convertToRoman()">1st, Convert to Roman Numerals</button>

    <div>
      <br />
      <br />
      <label for="newKey">2nd, convert to Desired Song Key:</label>
      <select id="newKey">
        <option value="C">C</option>
        <option value="Db">Db</option>

        <option value="D">D</option>
        <option value="Eb">Eb</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="Gb">Gb</option>
        <option value="G">G</option>
        <option value="Ab">Ab</option>
        <option value="A">A</option>
        <option value="Bb">Bb</option>
        <option value="B">B</option>
      </select>
      <button onclick="transposeSong()">Transpose Song</button>
    </div>

    <div>
      <h2>Converted Chart:</h2>
      <pre id="convertedChart"></pre>
    </div>

    <script>
      const songKeyConversion = {
        C: ["C", "D", "E", "F", "G", "A", "B"],
        Db: ["Db", "Eb", "F", "Gb", "Ab", "Bb", "C"],
        D: ["D", "E", "F#", "G", "A", "B", "C#"],
        Eb: ["Eb", "F", "G", "Ab", "Bb", "C", "D"],
        E: ["E", "F#", "G#", "A", "B", "C#", "D#"],
        F: ["F", "G", "A", "Bb", "C", "D", "E"],
        Gb: ["Gb", "Ab", "Bb", "Cb", "Db", "Eb", "F"],
        G: ["G", "A", "B", "C", "D", "E", "F#"],
        Ab: ["Ab", "Bb", "C", "Db", "Eb", "F", "G"],
        A: ["A", "B", "C#", "D", "E", "F#", "G#"],
        Bb: ["Bb", "C", "D", "Eb", "F", "G", "A"],
        B: ["B", "C#", "D#", "E", "F#", "G#", "A#"],
      };

      function extractKey(songChart) {
        const keyMatch = songChart.match(/Key\s*:\s*([A-G](?:b|#)?)/i);
        return keyMatch ? keyMatch[1] : null;
      }

      function processSongChart(songChart, key, isRomanConversion) {
        const originalKey = songKeyConversion[key];

        const musicalNoteRegex = /(?<=(^|[\s-]))[A-G](?:b|#)?(?=\s|-|$)/g;

        if (isRomanConversion) {
          return songChart.replace(musicalNoteRegex, (match) => {
            const index = originalKey.indexOf(match);
            return ["I", "II", "III", "IV", "V", "VI", "VII"][index];
          });
        } else {
          return songChart.replace(
            /(I|II|III|IV|V|VI|VII)(?=\s|-|$)/g,
            (match) => {
              const romanToIndex = {
                I: 0,
                II: 1,
                III: 2,
                IV: 3,
                V: 4,
                VI: 5,
                VII: 6,
              };
              const index = romanToIndex[match];
              return songKeyConversion[key][index];
            }
          );
        }
      }

      function convertToRoman() {
        const songChart = document.getElementById("songChart").value;
        const originalKey = extractKey(songChart);
        if (!originalKey) {
          alert("Unable to determine the song's original key.");
          return;
        }

        const romanChart = processSongChart(songChart, originalKey, true);
        document.getElementById("convertedChart").textContent = romanChart;
      }

      function transposeSong() {
        const romanChart =
          document.getElementById("convertedChart").textContent;
        const newKey = document.getElementById("newKey").value;
        const transposedChart = processSongChart(romanChart, newKey, false);
        document.getElementById("convertedChart").textContent = transposedChart;
      }
    </script>
  </body>
</html>
